import{db,saveDb}from"./db.js";function getServicesList(){const t=db.currentUser;return t&&Array.isArray(t.assignedRegisters)&&t.assignedRegisters.length?t.assignedRegisters:[]}export function renderVisitLog(t){db.facility||(db.facility={}),db.patients||(db.patients=[]),db.visits||(db.visits=[]);const e=db.visits||[];t.innerHTML=`\n    <div class="container my-4">\n      <div class="d-flex align-items-center justify-content-between">\n        <h4><i class="bi bi-journal-text"></i> Visits Logged</h4>\n      </div>\n      <div class="card shadow-sm mt-4">\n        <div class="card-body p-2">\n          <table class="table table-bordered table-sm mb-0 visit-table-mobile">\n            <thead>\n              <tr>\n                <th>Date</th>\n                <th>Patient</th>\n                <th>Service(s)</th>\n                <th>Provider</th>\n                <th>Notes</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.length?e.map(t=>`\n                <tr>\n                  <td data-label="Date">${t.visitDate||""}</td>\n                  <td data-label="Patient">${t.patientID||""}</td>\n                  <td data-label="Service(s)">${Array.isArray(t.serviceType)?t.serviceType.join(", "):t.serviceType||""}</td>\n                  <td data-label="Provider">${t.loggedBy||""}</td>\n                  <td data-label="Notes">${t.notes||""}</td>\n                </tr>\n              `).join(""):'<tr><td colspan="5" class="text-center text-muted">No visits logged yet.</td></tr>'}\n            </tbody>\n          </table>\n        </div>\n      </div>\n      <a href="#user-dashboard" class="btn btn-link mt-2"><i class="bi bi-arrow-left"></i> Back to Dashboard</a>\n    </div>\n  `}export function createVisitForm(t,e){const i=document.createElement("div");i.className="visit-form my-3",db.facility||(db.facility={}),db.patients||(db.patients=[]),db.visits||(db.visits=[]);const s=getServicesList();i.innerHTML=`\n    <form class="row g-2">\n      <div class="col-md-4">\n        <select class="form-select" multiple required size="4">\n          ${s.length?s.map(t=>`<option value="${t}">${t}</option>`).join(""):"<option disabled>No assigned services</option>"}\n        </select>\n      </div>\n      <div class="col-md-3">\n        <input type="date" class="form-control" max="${(new Date).toISOString().slice(0,10)}" value="${(new Date).toISOString().slice(0,10)}">\n      </div>\n      <div class="col-md-2">\n        <button class="btn btn-success w-100" type="submit"><i class="bi bi-check2-circle"></i> Save</button>\n      </div>\n    </form>\n    <div class="visit-msg mt-2"></div>\n  `;const n=i.querySelector("form");return n.onsubmit=function(s){s.preventDefault();const a=Array.from(n.querySelector("select").selectedOptions).map(t=>t.value),r=n.querySelector("input").value;if(!a.length)return void(i.querySelector(".visit-msg").innerHTML='<div class="alert alert-danger">Select a service</div>');const d={patientID:t.patientID,visitDate:r,serviceType:a,facility:db.facility?.name||"",loggedBy:db.currentUser?.username||"",timestamp:Date.now()};db.visits.push(d),saveDb(),i.querySelector(".visit-msg").innerHTML='<div class="alert alert-success">Visit logged!</div>',e&&e()},i}