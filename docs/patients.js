import{db,saveDb}from"./db.js";import{generatePatientID}from"./idUtils.js";import{calculateAge,formatDate}from"./utils.js";export function renderPatientList(t){if(!document.getElementById("modalWrap")){const t=document.createElement("div");t.id="modalWrap",document.body.appendChild(t)}function e(t={},e=!1){let n=db.patients||[];n=n.slice().sort((t,e)=>new Date(e.registrationDate||e.timestamp||0)-new Date(t.registrationDate||t.timestamp||0)),t.id&&(n=n.filter(e=>e.patientID?.includes(t.id))),t.name&&(n=n.filter(e=>e.name?.toLowerCase().includes(t.name.toLowerCase()))),t.phone&&(n=n.filter(e=>e.phone?.includes(t.phone))),document.getElementById("listBody").innerHTML=0===n.length?'<tr><td colspan="3" class="text-center text-muted">No patients found.</td></tr>':n.map((e,n)=>`\n      <tr id="row-${e.patientID}"${t.id&&e.patientID?.toLowerCase().includes(t.id.toLowerCase())?' class="table-info"':""}>\n        <td data-label="ID">${e.patientID||""}</td>\n        <td data-label="Name">${e.name||""}</td>\n        <td data-label="Actions">\n          <button class="btn btn-sm btn-primary me-1" data-i="${n}" data-act="view" title="View/Edit"><i class="bi bi-eye"></i></button>\n        </td>\n      </tr>`).join(""),document.querySelectorAll("[data-act=view]").forEach(t=>t.onclick=()=>{n[t.dataset.i]})}t.innerHTML='\n    <div class="container my-4">\n      <div class="d-flex justify-content-between align-items-center mb-2">\n        <h4><i class="bi bi-people"></i> Patients</h4>\n        <button id="showPatientFormBtn" class="btn btn-success btn-sm"><i class="bi bi-person-plus"></i> Add New Patient</button>\n      </div>\n      <form id="searchForm" class="d-flex gap-2 mb-3">\n        <input name="id"    class="form-control form-control-sm" placeholder="ID">\n        <input name="name"  class="form-control form-control-sm" placeholder="Name">\n        <input name="phone" class="form-control form-control-sm" placeholder="Phone">\n        <button class="btn btn-primary btn-sm"><i class="bi bi-search"></i></button>\n      </form>\n      <div id="formAboveList" style="display:none"></div>\n      <div class="table-responsive" id="patientTableWrap">\n        <table class="table table-bordered table-hover align-middle patient-table-mobile">\n          <thead class="table-light">\n            <tr>\n              <th>ID</th><th>Name</th><th>Actions</th>\n            </tr>\n          </thead>\n          <tbody id="listBody"></tbody>\n        </table>\n      </div>\n      <style>\n      @media (max-width: 768px) {\n        .patient-table-mobile thead { display: none; }\n        .patient-table-mobile tr { display: block; margin-bottom: 1rem; border: 1px solid #dee2e6; border-radius: 8px; }\n        .patient-table-mobile td { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 1rem; border: none; border-bottom: 1px solid #eee; }\n        .patient-table-mobile td:last-child { border-bottom: none; }\n        .patient-table-mobile td:before {\n          content: attr(data-label);\n          font-weight: bold;\n          flex: 0 0 40%;\n          color: #555;\n        }\n        .patient-table-mobile td { flex-direction: row; }\n      }\n      </style>\n      <a href="#user-dashboard" class="btn btn-link mt-2"><i class="bi bi-arrow-left"></i> Back</a>\n    </div>\n  ',document.getElementById("showPatientFormBtn").onclick=()=>{},document.getElementById("searchForm").onsubmit=t=>{t.preventDefault();e(Object.fromEntries(new FormData(t.target)),!0)},e()}