import{db,saveDb}from"./db.js";export function renderProfile(e){const s=db.currentUser;s?(e.innerHTML=`\n    <div class="container my-4">\n      <div class="card shadow mx-auto" style="max-width:400px;">\n        <div class="card-body">\n          <h4 class="mb-3"><i class="bi bi-person-circle"></i> Update Profile</h4>\n          <form id="profileForm" autocomplete="off">\n            <div class="mb-3">\n              <label class="form-label">Username</label>\n              <input class="form-control" value="${s.username}" readonly>\n            </div>\n            <div class="mb-3">\n              <label class="form-label">Full Name</label>\n              <input class="form-control" id="fullName" value="${s.name||""}" placeholder="Full Name" required>\n            </div>\n            <div class="mb-3">\n              <label class="form-label">Phone</label>\n              <input class="form-control" id="phone" value="${s.phone||""}" placeholder="Phone">\n            </div>\n            <hr>\n            <h6>Change Password</h6>\n            <div class="mb-2">\n              <label class="form-label">Current Password</label>\n              <input type="password" class="form-control" id="currentPassword" autocomplete="current-password">\n            </div>\n            <div class="mb-2">\n              <label class="form-label">New Password</label>\n              <input type="password" class="form-control" id="newPassword" autocomplete="new-password">\n            </div>\n            <div class="d-flex justify-content-between mt-3">\n              <button class="btn btn-primary">Save Changes</button>\n              <a href="#user-dashboard" class="btn btn-secondary">Cancel</a>\n            </div>\n            <div id="profileMsg" class="mt-2 small"></div>\n          </form>\n        </div>\n      </div>\n    </div>\n  `,document.getElementById("profileForm").onsubmit=function(e){e.preventDefault();const r=this.fullName.value.trim(),a=this.phone.value.trim(),n=this.currentPassword.value,l=this.newPassword.value;let o="";if(s.name=r,s.phone=a,n||l){if(!n||!l)return o="Both current and new password are required to change password.",this.querySelector("#profileMsg").textContent=o,void(this.querySelector("#profileMsg").className="text-danger mt-2 small");if(s.password!==n)return o="Current password is incorrect.",this.querySelector("#profileMsg").textContent=o,void(this.querySelector("#profileMsg").className="text-danger mt-2 small");s.password=l,s.lastPasswordChange=Date.now(),o="Password updated! "}const t=db.users.findIndex(e=>e.username===s.username);-1!==t&&(db.users[t].name=s.name,db.users[t].phone=s.phone,l&&(db.users[t].password=l,db.users[t].lastPasswordChange=s.lastPasswordChange),db.currentUser=db.users[t]),saveDb(),this.querySelector("#profileMsg").textContent=o+"Profile updated!",this.querySelector("#profileMsg").className="text-success mt-2 small",setTimeout(()=>{window.location.hash="#user-dashboard"},1200)}):e.innerHTML='<div class="alert alert-danger">No user logged in.</div>'}export function isPasswordExpired(e){if(!e)return!1;const s=e.lastPasswordChange||0;return(Date.now()-s)/864e5>30}