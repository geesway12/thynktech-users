window.setTheme=function(e){document.body.className=`theme-${e}`,localStorage.setItem("thynktech_theme",e)},document.body.className=`theme-${localStorage.getItem("thynktech_theme")||"blue"}`;import{db,saveDb,loadDb}from"./db.js";import{registerServiceWorker}from"./pwa.js";import{renderPatientList}from"./patients.js";import{renderVisitLog}from"./visits.js";import{renderReports}from"./reports.js";import{renderServiceVisitSelector}from"./services.js";import{renderUserDashboard}from"./users.js";import{renderAppointmentForm}from"./appointments.js";export const themePicker='\n  <div class="float-end mb-2">\n    <span class="me-2"><i class="bi bi-palette"></i> Theme:</span>\n    <button class="btn btn-sm btn-primary" onclick="setTheme(\'blue\')" title="Blue"></button>\n    <button class="btn btn-sm btn-success" onclick="setTheme(\'green\')" title="Green"></button>\n    <button class="btn btn-sm btn-accent" onclick="setTheme(\'orange\')" title="Orange"></button>\n    <button class="btn btn-sm btn-purple" style="background: #6f42c1; color:#fff;" onclick="setTheme(\'purple\')" title="Purple"></button>\n  </div>\n';function router(){const e=document.getElementById("app");if(!db.currentUser)return window.location.hash="#login",void renderLogin(e);const t=window.location.hash;if("#login"===t)renderLogin(e);else if("#user-dashboard"===t||""===t)renderUserDashboard(e);else if("#patient-reg"===t||"#patient-list"===t)renderPatientList(e);else if("#visit-log"===t)renderVisitLog(e);else if("#reports"===t)renderReports(e);else if("#profile"===t)import("./profile.js").then(t=>t.renderProfile(e));else if(t.startsWith("#appointment")){const r=t.split("-")[1],s=db.patients?.find(e=>e.patientID===r);s?renderAppointmentForm(s):renderUserDashboard(e)}else t.startsWith("#service-entry")?renderServiceVisitSelector(e):renderUserDashboard(e)}window.addEventListener("hashchange",router),window.addEventListener("load",()=>{loadDb(),registerServiceWorker(),router()});export function renderLogin(e){e.innerHTML='\n    <div class="container my-5" style="max-width:400px;">\n      <div class="card shadow">\n        <div class="card-body">\n          <h4 class="mb-3"><i class="bi bi-person-circle"></i> Thynktech User Login</h4>\n          <form id="loginForm" autocomplete="off">\n            <input class="form-control mb-2" name="username" placeholder="Username" required>\n            <input class="form-control mb-3" name="password" type="password" placeholder="Password" required>\n            <button class="btn btn-primary w-100 mb-2">Login</button>\n          </form>\n          <hr>\n          <div class="mb-2">\n            <label class="btn btn-outline-info btn-sm w-100">\n              <i class="bi bi-box-arrow-in-down"></i> Import System Setup\n              <input type="file" id="importSetupFile" hidden>\n            </label>\n            <div id="importMsg" class="small mt-2"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',e.querySelector("#loginForm").onsubmit=function(e){e.preventDefault();const t=this.username.value.trim(),r=this.password.value,s=db.users?.find(e=>e.username===t&&e.password===r);s?(db.currentUser=s,saveDb(),window.location.hash="#user-dashboard"):(this.querySelector("button").classList.add("btn-danger"),setTimeout(()=>this.querySelector("button").classList.remove("btn-danger"),1e3))},e.querySelector("#importSetupFile").addEventListener("change",function(t){const r=t.target.files[0];if(!r)return;const s=new FileReader;s.onload=function(t){try{const r=JSON.parse(t.target.result);db.facility=r.facility,db.settings=r.settings,db.users=r.users||[],db.registers=r.registers||[],db.roles=r.roles||[],db.servicesList=r.servicesList||[],db.customPatientFields=r.customPatientFields||[],saveDb(),e.querySelector("#importMsg").innerHTML='<span class="text-success">System setup imported! You can now log in with your credentials.</span>',setTimeout(()=>window.location.reload(),1200)}catch(t){e.querySelector("#importMsg").innerHTML='<span class="text-danger">Import failed: Invalid file.</span>'}},s.readAsText(r)})}