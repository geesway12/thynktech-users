import{db,saveDb,loadDb}from"./db.js";import{registerServiceWorker}from"./pwa.js";import{renderPatientList}from"./patients.js";import{renderVisitLog}from"./visits.js";import{renderReports}from"./reports.js";import{renderServiceVisitSelector}from"./services.js";import{renderUserDashboard}from"./users.js";import{renderAppointmentForm}from"./appointments.js";import{renderLogin}from"./auth.js";function router(){const e=document.getElementById("app");if(!db.currentUser)return window.location.hash="#login",void renderLogin(e);const r=window.location.hash;if("#login"===r)renderLogin(e);else if("#user-dashboard"===r||""===r)renderUserDashboard(e);else if("#patient-reg"===r||"#patient-list"===r)renderPatientList(e);else if("#visit-log"===r)renderVisitLog(e);else if("#reports"===r)renderReports(e);else if("#profile"===r)import("./utils.profile.js").then(r=>r.renderProfile(e,{dashboardHash:"#user-dashboard",getUser:()=>db.currentUser,updateUser:e=>{const r=db.users.findIndex(r=>r.username===e.username);-1!==r&&(db.users[r]={...db.users[r],...e}),db.currentUser=e,saveDb()},fieldLabels:{fullName:"Full Name",contact:"Phone"}}));else if(r.startsWith("#appointment")){const s=r.split("-")[1],t=db.patients?.find(e=>e.patientID===s);t?renderAppointmentForm(t):renderUserDashboard(e)}else r.startsWith("#service-entry")?renderServiceVisitSelector(e):renderUserDashboard(e)}window.addEventListener("hashchange",router),window.addEventListener("load",()=>{loadDb(),registerServiceWorker(),router()});