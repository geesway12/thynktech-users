import{db}from"./db.js";import{themePicker}from"./app.js";function loadChartJs(t){if(window.Chart)return t();const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/chart.js",e.onload=t,document.head.appendChild(e)}export function renderReports(t){t.innerHTML=`\n    <div class="container my-4">\n      <div class="d-flex justify-content-between align-items-center mb-3">\n        <h4><i class="bi bi-bar-chart"></i> Reports & Analytics</h4>\n        ${themePicker}\n      </div>\n      <div class="row g-3">\n        <div class="col-md-6">\n          <div class="card shadow-sm h-100">\n            <div class="card-body">\n              <h6 class="card-title">Patient Summary</h6>\n              <table class="table table-bordered mb-0">\n                <tr><th>Total Patients</th><td>${db.patients.length}</td></tr>\n                <tr><th>Male</th><td>${db.patients.filter(t=>"M"===t.sex).length}</td></tr>\n                <tr><th>Female</th><td>${db.patients.filter(t=>"F"===t.sex).length}</td></tr>\n                <tr><th>Other</th><td>${db.patients.filter(t=>"O"===t.sex).length}</td></tr>\n              </table>\n            </div>\n          </div>\n        </div>\n        <div class="col-md-6">\n          <div class="card shadow-sm h-100">\n            <div class="card-body">\n              <h6 class="card-title">Visits Summary</h6>\n              <table class="table table-bordered mb-0">\n                <tr><th>Total Visits</th><td>${db.visits.length}</td></tr>\n                <tr><th>Unique Patients Visited</th><td>${[...new Set(db.visits.map(t=>t.patientID))].length}</td></tr>\n                <tr><th>Most Recent Visit</th><td>${db.visits.length&&db.visits[db.visits.length-1].visitDate||""}</td></tr>\n              </table>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="row g-3 mt-3">\n        <div class="col-md-6">\n          <div class="card shadow-sm h-100">\n            <div class="card-body">\n              <h6 class="card-title">Patients by Sex</h6>\n              <canvas id="sexPie" height="180"></canvas>\n            </div>\n          </div>\n        </div>\n        <div class="col-md-6">\n          <div class="card shadow-sm h-100">\n            <div class="card-body">\n              <h6 class="card-title">Visits Trend (Last 12 Months)</h6>\n              <canvas id="visitTrend" height="180"></canvas>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="row g-3 mt-3">\n        <div class="col-md-12">\n          <div class="card shadow-sm">\n            <div class="card-body">\n              <h6 class="card-title">Top 5 Services Delivered</h6>\n              <canvas id="serviceBar" height="220"></canvas>\n            </div>\n          </div>\n        </div>\n      </div>\n      <a href="#admin-dashboard" class="btn btn-link mt-3"><i class="bi bi-arrow-left"></i> Back</a>\n    </div>\n  `,loadChartJs(()=>{const t=[db.patients.filter(t=>"M"===t.sex).length,db.patients.filter(t=>"F"===t.sex).length,db.patients.filter(t=>"O"===t.sex).length];new Chart(document.getElementById("sexPie"),{type:"pie",data:{labels:["Male","Female","Other"],datasets:[{data:t,backgroundColor:["#0d6efd","#e83e8c","#6c757d"]}]},options:{responsive:!0}});const e={};(db.visits||[]).forEach(t=>{(Array.isArray(t.serviceType)?t.serviceType:[t.serviceType]).forEach(t=>{t&&(e[t]=(e[t]||0)+1)})});const s=Object.entries(e).sort((t,e)=>e[1]-t[1]).slice(0,5);new Chart(document.getElementById("serviceBar"),{type:"bar",data:{labels:s.map(t=>t[0]),datasets:[{label:"Visits",data:s.map(t=>t[1]),backgroundColor:["#0d6efd","#20c997","#ffc107","#e83e8c","#6610f2"].slice(0,s.length)}]},options:{responsive:!0,indexAxis:"y",plugins:{legend:{display:!1}}}});const n=[],a=new Date;for(let t=11;t>=0;t--){const e=new Date(a.getFullYear(),a.getMonth()-t,1);n.push(`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`)}const i=n.map(t=>db.visits.filter(e=>(e.visitDate||"").slice(0,7)===t).length);new Chart(document.getElementById("visitTrend"),{type:"line",data:{labels:n,datasets:[{label:"Visits",data:i,borderColor:"#198754",backgroundColor:"rgba(25,135,84,0.2)",fill:!0}]},options:{responsive:!0}})})}