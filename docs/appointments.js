import{db,saveDb}from"./db.js";export function renderAppointmentForm(t){const e=document.getElementById("app"),n=(new Date).toISOString().split("T")[0],a=(db.registers||[]).filter(t=>!t.assignedUsers||0===t.assignedUsers.length||db.currentUser&&t.assignedUsers.includes(db.currentUser.username));e.innerHTML=`\n    <div class="container py-3">\n      <h4><i class="bi bi-calendar-plus"></i> Schedule Appointment for ${t.name}</h4>\n      <form id="appointmentForm" class="row g-3">\n        <div class="col-md-6">\n          <label class="form-label">Service</label>\n          <select class="form-select" id="appointmentService" required>\n            <option value="">Select service</option>\n            ${a.map(t=>`<option value="${t.name}">${t.name}</option>`).join("")}\n          </select>\n        </div>\n        <div class="col-md-6">\n          <label class="form-label">Appointment Date</label>\n          <input type="date" class="form-control" id="appointmentDate" min="${n}" required>\n        </div>\n        <div class="col-md-12">\n          <label class="form-label">Notes (optional)</label>\n          <textarea class="form-control" id="appointmentNotes" rows="2"></textarea>\n        </div>\n        <div class="col-md-12">\n          <button class="btn btn-primary" type="submit"><i class="bi bi-check2-circle"></i> Save Appointment</button>\n          <a href="#appointments" class="btn btn-secondary ms-2">Cancel</a>\n        </div>\n        <div id="appointmentMsg" class="mt-3"></div>\n      </form>\n    </div>\n  `,document.getElementById("appointmentForm").onsubmit=function(e){e.preventDefault();const n=document.getElementById("appointmentService").value,a=document.getElementById("appointmentDate").value,i=document.getElementById("appointmentNotes").value;n&&a?(db.appointments=db.appointments||[],db.appointments.push({patientID:t.patientID,patientName:t.name,serviceType:n,appointmentDate:a,notes:i,status:"Scheduled",createdBy:db.currentUser?.username||"",timestamp:Date.now()}),saveDb(),document.getElementById("appointmentMsg").innerHTML='<div class="alert alert-success">Appointment saved successfully.</div>',setTimeout(()=>location.hash="#appointments",1200)):document.getElementById("appointmentMsg").innerHTML='<div class="alert alert-danger">Service and date are required.</div>'}}export function renderAppointmentList(t){function e(t=""){let n=db.appointments||[];if(t){const e=t.trim().toLowerCase();n=n.filter(t=>t.patientID&&t.patientID.toLowerCase().includes(e)||t.patientName&&t.patientName.toLowerCase().includes(e))}n=n.sort((t,e)=>e.timestamp-t.timestamp).slice(0,20),document.getElementById("appointmentsBody").innerHTML=n.length?n.map((t,e)=>`\n        <tr>\n          <td data-label="Patient ID">${t.patientID}</td>\n          <td data-label="Name">${t.patientName}</td>\n          <td data-label="Service">${t.serviceType}</td>\n          <td data-label="Date">${t.appointmentDate}</td>\n          <td data-label="Notes">${t.notes||""}</td>\n          <td data-label="Status">\n            <span class="badge ${"Completed"===t.status?"bg-success":"bg-warning text-dark"}">${t.status}</span>\n          </td>\n          <td data-label="Actions">\n            ${"Completed"!==t.status?`<button class="btn btn-sm btn-success" data-i="${e}" data-act="complete"><i class="bi bi-check2"></i> Mark Completed</button>`:""}\n            <button class="btn btn-sm btn-danger" data-i="${e}" data-act="delete"><i class="bi bi-trash"></i></button>\n          </td>\n        </tr>\n      `).join(""):'<tr><td colspan="7" class="text-center text-muted">No appointments found.</td></tr>',document.querySelectorAll("[data-act=complete]").forEach(n=>{n.onclick=()=>{const a=parseInt(n.getAttribute("data-i")),i=db.appointments.sort((t,e)=>e.timestamp-t.timestamp).filter(e=>!t||e.patientID&&e.patientID.toLowerCase().includes(t.trim().toLowerCase())||e.patientName&&e.patientName.toLowerCase().includes(t.trim().toLowerCase())).slice(0,20)[a];i&&(i.status="Completed",saveDb(),e(t))}}),document.querySelectorAll("[data-act=delete]").forEach(n=>{n.onclick=()=>{if(confirm("Delete this appointment?")){const a=parseInt(n.getAttribute("data-i")),i=db.appointments.sort((t,e)=>e.timestamp-t.timestamp).filter(e=>!t||e.patientID&&e.patientID.toLowerCase().includes(t.trim().toLowerCase())||e.patientName&&e.patientName.toLowerCase().includes(t.trim().toLowerCase())).slice(0,20)[a];i&&(db.appointments=db.appointments.filter(t=>t!==i),saveDb(),e(t))}}})}t.innerHTML='\n    <div class="container py-3">\n      <div class="d-flex justify-content-between align-items-center mb-3">\n        <h4><i class="bi bi-calendar-event"></i> Appointments</h4>\n        <form id="searchAppointments" class="d-flex gap-2">\n          <input class="form-control" type="text" id="searchTerm" placeholder="Search by Patient ID or Name" autocomplete="off">\n          <button class="btn btn-outline-primary" type="submit"><i class="bi bi-search"></i></button>\n        </form>\n      </div>\n      <div class="table-responsive">\n        <table class="table table-bordered table-hover align-middle appointment-table-mobile">\n          <thead class="table-light">\n            <tr>\n              <th>Patient ID</th>\n              <th>Name</th>\n              <th>Service</th>\n              <th>Date</th>\n              <th>Notes</th>\n              <th>Status</th>\n              <th>Actions</th>\n            </tr>\n          </thead>\n          <tbody id="appointmentsBody"></tbody>\n        </table>\n      </div>\n      <style>\n      @media (max-width: 768px) {\n        .appointment-table-mobile thead { display: none; }\n        .appointment-table-mobile tr { display: block; margin-bottom: 1rem; border: 1px solid #dee2e6; border-radius: 8px; }\n        .appointment-table-mobile td { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 1rem; border: none; border-bottom: 1px solid #eee; }\n        .appointment-table-mobile td:last-child { border-bottom: none; }\n        .appointment-table-mobile td:before {\n          content: attr(data-label);\n          font-weight: bold;\n          flex: 0 0 40%;\n          color: #555;\n        }\n        .appointment-table-mobile td { flex-direction: row; }\n      }\n      </style>\n      <a href="#user-dashboard" class="btn btn-link mt-2"><i class="bi bi-arrow-left"></i> Back to Dashboard</a>\n    </div>\n  ',e(),document.getElementById("searchAppointments").onsubmit=function(t){t.preventDefault();e(document.getElementById("searchTerm").value)}}